"use strict";const e=require("electron"),g=require("node:os"),i=require("node:path"),a=require("electron-updater");a.autoUpdater.autoDownload=!0;a.autoUpdater.setFeedURL({provider:"github",owner:"MuhiddinWebDev",repo:"frontend",private:!1,vPrefixedTagName:!0});process.env.DIST_ELECTRON=i.join(__dirname,"..");process.env.DIST=i.join(process.env.DIST_ELECTRON,"../dist");process.env.VITE_PUBLIC=process.env.VITE_DEV_SERVER_URL?i.join(process.env.DIST_ELECTRON,"../public"):process.env.DIST;g.release().startsWith("6.1")&&e.app.disableHardwareAcceleration();process.platform==="win32"&&e.app.setAppUserModelId(e.app.getName());e.app.requestSingleInstanceLock()||(e.app.quit(),process.exit(0));let o=null;const d=i.join(__dirname,"../preload/index.js"),p=process.env.VITE_DEV_SERVER_URL,c=i.join(process.env.DIST,"index.html");async function u(){const{width:t,height:s}=e.screen.getPrimaryDisplay().workAreaSize;o=new e.BrowserWindow({title:"Main window",icon:i.join(process.env.VITE_PUBLIC,"logo.png"),width:t,height:s,webPreferences:{preload:d,nodeIntegration:!0,contextIsolation:!0,sandbox:!0,webSecurity:!0,devTools:!0},autoHideMenuBar:!0}),process.env.VITE_DEV_SERVER_URL?(o.loadURL(p),o.webContents.openDevTools()):o.loadFile(c),o.webContents.on("did-finish-load",()=>{o==null||o.webContents.send("main-process-message",new Date().toLocaleString())}),o.webContents.setWindowOpenHandler(({url:r})=>(r.startsWith("https:")&&e.shell.openExternal(r),{action:"deny"}));let n=!1;o.on("close",r=>{if(!n){r.preventDefault();const w={type:"question",buttons:["Chiqish","Bekor qilish"],defaultId:0,title:"Ilovadan chiqing",message:"Haqiqatan ham ilovadan chiqmoqchimisiz?",cancelId:5};e.dialog.showMessageBox(o,w).then(l=>{console.log(l.response),l.response===0?(n=!0,e.app.quit()):n=!1})}})}e.app.whenReady().then(u);e.app.on("window-all-closed",()=>{o=null,process.platform!=="darwin"&&e.app.quit()});e.app.on("second-instance",()=>{o&&(o.isMinimized()&&o.restore(),o.focus())});e.app.on("activate",()=>{const t=e.BrowserWindow.getAllWindows();t.length?t[0].focus():u()});e.ipcMain.handle("open-win",(t,s)=>{const n=new e.BrowserWindow({webPreferences:{preload:d,nodeIntegration:!0,contextIsolation:!1}});console.log(process.env),process.env.VITE_DEV_SERVER_URL?n.loadURL(`${p}#${s}`):n.loadFile(c,{hash:s})});e.app.on("browser-window-focus",()=>{e.globalShortcut.register("CommandOrControl+R",()=>{console.log("CommandOrControl+R is pressed: Shortcut Disabled")})});e.app.on("browser-window-blur",function(){e.globalShortcut.unregister("CommandOrControl+R")});e.app.commandLine.appendSwitch("ignore-certificate-errors");e.app.on("ready",async()=>{await a.autoUpdater.checkForUpdates()});a.autoUpdater.on("update-downloaded",async t=>{const s={type:"question",buttons:["Yang"],title:"Eng so'nggi versiya yuklangan",message:"Eng so'nggi versiya yuklangan",defaultId:0,cancelId:0};e.dialog.showMessageBox(o,s).then(n=>{n.response===0&&a.autoUpdater.quitAndInstall()})});e.app.commandLine.appendSwitch("ignore-certificate-errors","true");
