{"version":3,"file":"index.js","sources":["../../electron/main/index.ts"],"sourcesContent":["import { app, BrowserWindow, shell, ipcMain, globalShortcut, dialog, screen } from 'electron'\r\nimport { release } from 'node:os'\r\nimport { join } from 'node:path'\r\nimport { autoUpdater } from 'electron-updater'\r\n\r\nautoUpdater.autoDownload = true\r\n\r\nautoUpdater.setFeedURL({\r\n  provider: 'github',\r\n  owner: 'MuhiddinWebDev',\r\n  repo: 'frontend',\r\n  private: false,\r\n  vPrefixedTagName:true\r\n})\r\n\r\nprocess.env.DIST_ELECTRON = join(__dirname, '..')\r\nprocess.env.DIST = join(process.env.DIST_ELECTRON, '../dist')\r\nprocess.env.VITE_PUBLIC = process.env.VITE_DEV_SERVER_URL\r\n  ? join(process.env.DIST_ELECTRON, '../public')\r\n  : process.env.DIST\r\n\r\nif (release().startsWith('6.1')) app.disableHardwareAcceleration()\r\n\r\nif (process.platform === 'win32') app.setAppUserModelId(app.getName())\r\n\r\nif (!app.requestSingleInstanceLock()) {\r\n  app.quit()\r\n  process.exit(0)\r\n}\r\n\r\nlet win: BrowserWindow | null = null\r\nconst preload = join(__dirname, '../preload/index.js')\r\nconst url = process.env.VITE_DEV_SERVER_URL\r\nconst indexHtml = join(process.env.DIST, 'index.html')\r\n\r\nasync function createWindow() {\r\n  const { width, height } = screen.getPrimaryDisplay().workAreaSize;\r\n  win = new BrowserWindow({\r\n    title: 'Main window',\r\n    icon: join(process.env.VITE_PUBLIC, 'favicon.ico'),\r\n    width:width,\r\n    height: height,\r\n    webPreferences: {\r\n      preload,\r\n      nodeIntegration: true, // Disable Node.js integration\r\n      contextIsolation: true, // Enable context isolation\r\n      sandbox: true,\r\n      webSecurity: true,\r\n      devTools:true\r\n    },\r\n    autoHideMenuBar: true\r\n  })\r\n\r\n  if (process.env.VITE_DEV_SERVER_URL) { \r\n    win.loadURL(url)\r\n    win.webContents.openDevTools()\r\n  } else {\r\n    win.loadFile(indexHtml)\r\n  }\r\n\r\n  win.webContents.on('did-finish-load', () => {\r\n    win?.webContents.send('main-process-message', new Date().toLocaleString())\r\n  })\r\n\r\n  win.webContents.setWindowOpenHandler(({ url }) => {\r\n    if (url.startsWith('https:')) shell.openExternal(url)\r\n    return { action: 'deny' }\r\n  })\r\n  let closeboll = false\r\n  win.on('close', (e) => {\r\n    if(!closeboll){\r\n      e.preventDefault();\r\n      const options: Electron.MessageBoxOptions = {\r\n        type: 'question',\r\n        buttons: ['Chiqish','Bekor qilish'],\r\n        defaultId: 0,\r\n        title: 'Ilovadan chiqing',\r\n        message: 'Haqiqatan ham ilovadan chiqmoqchimisiz?',\r\n        cancelId: 5,\r\n      };\r\n  \r\n      dialog.showMessageBox(win!, options).then((response) => {\r\n        console.log(response.response);\r\n        if (response.response === 0) {\r\n          closeboll = true\r\n          app.quit();\r\n        }else{\r\n          closeboll = false\r\n        }\r\n      });\r\n    }\r\n  });\r\n  \r\n}\r\n\r\napp.whenReady().then(createWindow)\r\n\r\napp.on('window-all-closed', () => {\r\n  win = null\r\n  if (process.platform !== 'darwin') app.quit()\r\n})\r\n\r\napp.on('second-instance', () => {\r\n  if (win) {\r\n    // Focus on the main window if the user tried to open another\r\n    if (win.isMinimized()) win.restore()\r\n    win.focus()\r\n  }\r\n})\r\n\r\napp.on('activate', () => {\r\n  const allWindows = BrowserWindow.getAllWindows()\r\n  if (allWindows.length) {\r\n    allWindows[0].focus()\r\n  } else {\r\n    createWindow()\r\n  }\r\n})\r\n\r\n// New window example arg: new windows url\r\nipcMain.handle('open-win', (_, arg) => {\r\n  const childWindow = new BrowserWindow({\r\n    webPreferences: {\r\n      preload,\r\n      nodeIntegration: true,\r\n      contextIsolation: false,\r\n    },\r\n  })\r\n  console.log(process.env)\r\n  if (process.env.VITE_DEV_SERVER_URL) {\r\n    childWindow.loadURL(`${url}#${arg}`)\r\n  } else {\r\n    childWindow.loadFile(indexHtml, { hash: arg })\r\n  }\r\n})\r\napp.on('browser-window-focus', () => {\r\n  globalShortcut.register('CommandOrControl+R', () => {\r\n    console.log(\"CommandOrControl+R is pressed: Shortcut Disabled\");\r\n  })\r\n})\r\napp.on('browser-window-blur', function () {\r\n  globalShortcut.unregister('CommandOrControl+R');\r\n});\r\napp.commandLine.appendSwitch('ignore-certificate-errors');\r\napp.on('ready',async () => {\r\n  await autoUpdater.checkForUpdates()\r\n})\r\nautoUpdater.on('update-downloaded', async (info) => {\r\n  const options: Electron.MessageBoxOptions = {\r\n    type: 'question',\r\n    buttons: ['Yang'],\r\n    title: \"Eng so'nggi versiya yuklangan\",\r\n    message: \"Eng so'nggi versiya yuklangan\",\r\n    defaultId: 0,\r\n    cancelId: 0,\r\n  };\r\n\r\n  dialog.showMessageBox(win!, options).then((response) => {\r\n    if(response.response === 0){\r\n      autoUpdater.quitAndInstall()\r\n    }\r\n  });\r\n  // dialog.showMessageBox({\r\n  //   type: 'question',\r\n  //   buttons: ['Обновлять'],\r\n  //   message: 'Последняя версия загружена',\r\n  //   defaultId: 0,\r\n  // }).then(res => {\r\n  //   if(res.response === 0){\r\n  //     autoUpdater.quitAndInstall()\r\n  //   }\r\n  // })\r\n})\r\n\r\napp.commandLine.appendSwitch('ignore-certificate-errors', 'true');"],"names":["autoUpdater","join","release","app","screen","BrowserWindow","url","shell","dialog","ipcMain","globalShortcut"],"mappings":"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"}